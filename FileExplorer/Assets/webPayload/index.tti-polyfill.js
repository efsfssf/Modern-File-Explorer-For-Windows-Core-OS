(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{1429:function(e,t,i){"use strict";i.r(t),i.d(t,"getFirstConsistentlyInteractive",(function(){return d}));var n=i(0),r=0;var s=["img","script","iframe","link","audio","video","source"];function o(e,t){for(var i=0,n=e;i<n.length;i++){var r=n[i];if(t.includes(r.nodeName.toLowerCase())||o(r.children,t))return!0}return!1}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];u()&&console.log.apply(console,e)}function u(){try{if("sessionStorage"in window&&window.sessionStorage){var e=window.sessionStorage.enableTTILogging;return e&&"true"===e.toLowerCase()&&"undefined"!=typeof console&&!!console}}catch(e){}return!1}function c(e,t){if(e.length>2)return performance.now();for(var i=[],n=0,r=t;n<r.length;n++){var s=r[n];i.push({timestamp:s.start,type:"requestStart"}),i.push({timestamp:s.end,type:"requestEnd"})}for(var o=0,a=e;o<a.length;o++){var u=a[o];i.push({timestamp:u,type:"requestStart"})}i.sort((function(e,t){return e.timestamp-t.timestamp}));for(var c=e.length,l=i.length-1;l>=0;l--){var d=i[l];switch(d.type){case"requestStart":c--;break;case"requestEnd":if(++c>2)return d.timestamp;break;default:throw Error("Internal Error: This should never happen")}}return 0}var l=function(){function e(e){var t=this;void 0===e&&(e={}),this._useMutationObserver=!!e.useMutationObserver,this._trackNetworkRequests=!!e.trackNetworkRequests,this._minValue=e.minValue||null,this._requiredMainThreadQuietnessDurationInMilliseconds=e.requiredMainThreadQuietnessDurationInMilliseconds||5e3,this._requiredNetworkQuietnessDurationInMilliseconds=e.requiredNetworkQuietnessDurationInMilliseconds||5e3;var i=window.__tti&&window.__tti.e,n=window.__tti&&window.__tti.o;this._longTaskId=0,i?(a("Consuming the long task entries already recorded."),this._longTasks=i.map((function(e){return{start:e.startTime,end:e.startTime+e.duration,id:t._longTaskId++}}))):this._longTasks=[],n&&n.disconnect(),this._networkRequests=[],this._incompleteJSInitiatedRequestStartTimes=new Map,this._timerId=void 0,this._timerActivationTime=-1/0,this._scheduleTimerTasks=!1,this._firstConsistentlyInteractiveResolver=null,this._performanceObserver=null,this._mutationObserver=null,this._registerListeners(this._trackNetworkRequests)}return e.prototype.getFirstConsistentlyInteractive=function(){var e=this;return new Promise((function(t,i){e._firstConsistentlyInteractiveResolver=t,"complete"===document.readyState?e.startSchedulingTimerTasks():window.addEventListener("load",(function(){e.startSchedulingTimerTasks()}))}))},e.prototype.startSchedulingTimerTasks=function(){a("Enabling FirstConsistentlyInteractiveDetector"),this._scheduleTimerTasks=!0;var e=this._longTasks.length>0?this._longTasks[this._longTasks.length-1].end:0,t=c(this._incompleteRequestStarts(),this._networkRequests);this._rescheduleTimer(Math.max(this._trackNetworkRequests?t+this._requiredNetworkQuietnessDurationInMilliseconds:0,e))},e.prototype._rescheduleTimer=function(e){var t=this;this._scheduleTimerTasks?(a("Attempting to reschedule FirstConsistentlyInteractive check to "+e),a("Previous timer activation time: "+this._timerActivationTime),this._timerActivationTime>e?a("Current activation time is greater than attempted reschedule time. No need to postpone."):(clearTimeout(this._timerId),this._timerId=setTimeout((function(){t._checkTTI()}),Math.max(0,e-performance.now())),this._timerActivationTime=e,a("Rescheduled firstConsistentlyInteractive check at "+e))):a("startSchedulingTimerTasks must be called before calling rescheduleTimer")},e.prototype._disable=function(){a("Disabling FirstConsistentlyInteractiveDetector"),clearTimeout(this._timerId),this._scheduleTimerTasks=!1,this._unregisterListeners()},e.prototype._registerPerformanceObserver=function(e){var t=this;void 0===e&&(e=!0),this._performanceObserver=new PerformanceObserver((function(i){for(var n=0,r=i.getEntries();n<r.length;n++){var s=r[n];"resource"===s.entryType&&e&&t._networkRequestFinishedCallback(s),"longtask"===s.entryType&&t._longTaskFinishedCallback(s)}})),this._performanceObserver.observe({entryTypes:e?["longtask","resource"]:["longtask"]})},e.prototype._registerListeners=function(e){var t,i,n,a,u,c,l,d,h;void 0===e&&(e=!0),e&&(a=this._beforeJSInitiatedRequestCallback.bind(this),u=this._afterJSInitiatedRequestCallback.bind(this),c=XMLHttpRequest.prototype.send,l=r++,XMLHttpRequest.prototype.send=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return a(l.toString()),this.addEventListener("readystatechange",(function(){4===e.readyState&&u(l.toString())})),c.apply(this,t)},t=this._beforeJSInitiatedRequestCallback.bind(this),i=this._afterJSInitiatedRequestCallback.bind(this),n=window.fetch,window.fetch=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return new Promise((function(s,o){var a=r++;t(a.toString()),n.apply(void 0,e).then((function(e){i(a.toString()),s(e)}),(function(e){i(e),o(e)}))}))}),this._registerPerformanceObserver(e),this._useMutationObserver&&(this._mutationObserver=(d=this._mutationObserverCallback.bind(this),(h=new MutationObserver((function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t];("childList"===n.type&&o(n.addedNodes,s)||"attributes"===n.type&&s.includes(n.target.tagName.toLowerCase()))&&d(n)}}))).observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]}),h))},e.prototype._unregisterListeners=function(){this._performanceObserver&&this._performanceObserver.disconnect(),this._mutationObserver&&this._mutationObserver.disconnect()},e.prototype._beforeJSInitiatedRequestCallback=function(e){a("Starting JS initiated request. Request ID: "+e),this._incompleteJSInitiatedRequestStartTimes.set(e,performance.now()),a("Active XHRs: "+this._incompleteJSInitiatedRequestStartTimes.size)},e.prototype._afterJSInitiatedRequestCallback=function(e){a("Completed JS initiated request with request ID: "+e),this._incompleteJSInitiatedRequestStartTimes.delete(e),a("Active XHRs: "+this._incompleteJSInitiatedRequestStartTimes.size)},e.prototype._networkRequestFinishedCallback=function(e){a("Network request finished",e),this._networkRequests.push({start:e.fetchStart,end:e.responseEnd}),this._rescheduleTimer(c(this._incompleteRequestStarts(),this._networkRequests)+this._requiredNetworkQuietnessDurationInMilliseconds)},e.prototype._longTaskFinishedCallback=function(e){a("Long task finished",e);var t,i=e.startTime+e.duration,n={start:e.startTime,end:i,id:this._longTaskId++},r="longTaskEnd"+n.id;t=r,window.performance&&performance.mark&&performance.mark(t),n.endMarkName=r,this._longTasks.push(n),this._rescheduleTimer(i+this._requiredMainThreadQuietnessDurationInMilliseconds)},e.prototype._mutationObserverCallback=function(e){a("Potentially network resource fetching mutation detected",e),a("Pushing back FirstConsistentlyInteractive check by "+this._requiredNetworkQuietnessDurationInMilliseconds+" milliseconds."),this._rescheduleTimer(performance.now()+this._requiredNetworkQuietnessDurationInMilliseconds)},e.prototype._getMinValue=function(){return this._minValue?this._minValue:performance.timing.domContentLoadedEventEnd?performance.timing.domContentLoadedEventEnd-performance.timing.navigationStart:null},e.prototype._incompleteRequestStarts=function(){return Object(n.__spreadArrays)(Array.from(this._incompleteJSInitiatedRequestStartTimes.values()))},e.prototype._checkTTI=function(){a("Checking if First Consistently Interactive was reached...");var e=performance.timing.navigationStart,t=c(this._incompleteRequestStarts(),this._networkRequests),i=(window.chrome&&window.chrome.loadTimes?1e3*window.chrome.loadTimes().firstPaintTime-e:0)||performance.timing.domContentLoadedEventEnd-e,n=this._getMinValue(),r=performance.now();if(null===n)return a("No usable minimum value yet. Postponing check."),void this._rescheduleTimer(Math.max(this._trackNetworkRequests?t+this._requiredNetworkQuietnessDurationInMilliseconds:0,r+1e3));a("Parameter values:"),a("NavigationStart",e),a("lastKnownNetwork2Busy",t),a("Search Start",i),a("Min Value",n),a("Last busy",t),a("Current time",r),a("Long tasks",this._longTasks),a("Incomplete JS Request Start Times",this._incompleteRequestStarts()),a("Network requests",this._networkRequests);var s=function(e,t,i,n,r,s,o,a){if(s&&n-i<a)return null;var u=0===r.length?e:r[r.length-1].end;if(n-u<o)return null;if(u&&r.length>0){var c=r[r.length-1].endMarkName;c&&performance.measure("TTI",void 0,c)}return Math.max(u,t)}(i,n,t,r,this._longTasks,this._trackNetworkRequests,this._requiredMainThreadQuietnessDurationInMilliseconds,this._requiredNetworkQuietnessDurationInMilliseconds);s&&this._firstConsistentlyInteractiveResolver&&(this._firstConsistentlyInteractiveResolver(s),this._disable()),a("Could not detect First Consistently Interactive. Retrying in 1 second."),this._rescheduleTimer(performance.now()+1e3)},e}();function d(e){return void 0===e&&(e={}),"PerformanceLongTaskTiming"in window?new l(e).getFirstConsistentlyInteractive():Promise.resolve(null)}},1477:function(e,t,i){e.exports=i(1429)}}]);
//# sourceMappingURL=index.tti-polyfill.js.map